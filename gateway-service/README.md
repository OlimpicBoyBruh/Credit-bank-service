# Gateway-service

## Описание

Микросервис "Gateway-service" предоставляет удобное API для клиентов и осуществляет отправку REST-запросов к другим сервисам.

## Технологии

- Java
- Spring Boot
- Docker

## API Методы

### Расчет возможных кредитных условий

**POST /statement**

Этот метод позволяет получить список возможных кредитных предложений на основе предоставленных данных. Также сохраняет данные в сущности Client и Statement.

#### Логика работы:

1. Получение LoanStatementRequestDto через API.
2. Создание сущности Client на основе LoanStatementRequestDto и сохранение в базе данных.
3. Создание сущности Statement ссылкой на только что созданного Client и сохранение в базе данных.
4. Отправка POST-запроса на /calculator/offers к сервису "Калькулятор" через FeignClient (или RestTemplate).
5. Присвоение каждому элементу списка List<LoanOfferDto> идентификатора созданной заявки (Statement).
6. Возвращение списка из 4 LoanOfferDto от "худшего" к "лучшему".

### Выбор предложения

**POST /offer/select**

Этот метод позволяет выбрать одно из предложений.

#### Логика работы:

1. Получение LoanOfferDto через API.
2. Извлечение заявки (Statement) из базы данных по statementId из LoanOfferDto.
3. Обновление статуса и истории статусов в заявке, принятие предложения LoanOfferDto устанавливается в поле appliedOffer.
4. Сохранение обновленной заявки.

### Расчет точных условий кредита

**POST /calculate/{statementId}**

Этот метод позволяет завершить регистрацию и произвести полный расчет кредита.

#### Логика работы:

1. Получение объекта FinishRegistrationRequestDto и параметра statementId через API.
2. Извлечение заявки (Statement) из базы данных по statementId.
3. Наполнение ScoringDataDto информацией из FinishRegistrationRequestDto и Client, хранящегося в Statement.
4. Отправка POST-запроса на /calculator/calc к сервису "Калькулятор" с телом ScoringDataDto через FeignClient.
5. Создание сущности Credit на основе полученного от кредитного конвейера CreditDto и сохранение в базе данных со статусом CALCULATED.
6. Обновление статуса и истории статусов в заявке.
7. Сохранение обновленной заявки.

### Создание и отправка документов

**POST /document/{statementId}**

Этот метод позволяет создать и отправить сформированные документы.

### Подписание документов

**POST /document/{statementId}/sign**

Этот метод позволяет подписать документы.

### Запрос на выдачу кредита

**POST /document/{statementId}/sign/code**

Этот метод позволяет отправить запрос на подтверждение выдачи кредита с кодом подтверждения.

